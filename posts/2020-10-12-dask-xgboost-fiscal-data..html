<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.336">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science - Visualizing Operations with Dask Dataframes on Fiscal Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Data Science</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/davidrkearney" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/davidrkearney" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Visualizing Operations with Dask Dataframes on Fiscal Data</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>This post includes code from <a href="https://github.com/PacktPublishing/-Scalable-Data-Analysis-in-Python-with-Dask/tree/master/Section%202">Scalable-Data-Analysis-in-Python-with-Dask</a> and <a href="https://github.com/coiled/coiled-examples">coiled-examples</a>.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dask.array <span class="im">as</span> da</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlalchemy <span class="im">as</span> db</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlalchemy <span class="im">import</span> create_engine</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>engine <span class="op">=</span> db.create_engine(<span class="st">"sqlite:///fiscal_data.db"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>connection <span class="op">=</span> engine.<span class="ex">connect</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> db.MetaData()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#engine.execute("SELECT * FROM fiscal_data LIMIT 1").fetchall()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sql <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT year</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="st">, region</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="st">, province</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="st">, gdp</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="st">, fdi</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="st">, it</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="st">, specific</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="st">FROM fiscal_data</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>cnxn <span class="op">=</span> connection</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_sql(sql, cnxn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">province</th>
<th data-quarto-table-cell-role="th">gdp</th>
<th data-quarto-table-cell-role="th">fdi</th>
<th data-quarto-table-cell-role="th">it</th>
<th data-quarto-table-cell-role="th">specific</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1996</td>
<td>East China</td>
<td>Anhui</td>
<td>2093.3</td>
<td>50661</td>
<td>631930</td>
<td>147002.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1997</td>
<td>East China</td>
<td>Anhui</td>
<td>2347.32</td>
<td>43443</td>
<td>657860</td>
<td>151981.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1998</td>
<td>East China</td>
<td>Anhui</td>
<td>2542.96</td>
<td>27673</td>
<td>889463</td>
<td>174930.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1999</td>
<td>East China</td>
<td>Anhui</td>
<td>2712.34</td>
<td>26131</td>
<td>1227364</td>
<td>285324.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000</td>
<td>East China</td>
<td>Anhui</td>
<td>2902.09</td>
<td>31847</td>
<td>1499110</td>
<td>195580.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">355</td>
<td>2003</td>
<td>East China</td>
<td>Zhejiang</td>
<td>9705.02</td>
<td>498055</td>
<td>2261631</td>
<td>391292.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">356</td>
<td>2004</td>
<td>East China</td>
<td>Zhejiang</td>
<td>11648.7</td>
<td>668128</td>
<td>3162299</td>
<td>656175.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">357</td>
<td>2005</td>
<td>East China</td>
<td>Zhejiang</td>
<td>13417.68</td>
<td>772000</td>
<td>2370200</td>
<td>656175.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">358</td>
<td>2006</td>
<td>East China</td>
<td>Zhejiang</td>
<td>15718.47</td>
<td>888935</td>
<td>2553268</td>
<td>1017303.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">359</td>
<td>2007</td>
<td>East China</td>
<td>Zhejiang</td>
<td>18753.73</td>
<td>1036576</td>
<td>2939778</td>
<td>844647.0</td>
</tr>
</tbody>
</table>

<p>360 rows × 7 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>Index(['year', 'region', 'province', 'gdp', 'fdi', 'it', 'specific'], dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df.gdp.hist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f0272396c50&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2020-10-12-dask-xgboost-fiscal-data._files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dask.distributed <span class="im">import</span> Client</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> Client(processes<span class="op">=</span><span class="va">False</span>, threads_per_worker<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                n_workers<span class="op">=</span><span class="dv">3</span>, memory_limit<span class="op">=</span><span class="st">'4GB'</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>client</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<tbody>
<tr class="odd">
<td style="vertical-align: top; border: 0px solid white"><h3 id="client" style="text-align: left;" class="anchored">Client</h3>
<ul>
<li><strong>Scheduler:</strong> inproc://192.168.1.71/5995/1</li>
<li><strong>Dashboard:</strong> <a href="http://192.168.1.71:8787/status" target="_blank">http://192.168.1.71:8787/status</a></li>
</ul></td>
<td style="vertical-align: top; border: 0px solid white"><h3 id="cluster" style="text-align: left;" class="anchored">Cluster</h3>
<ul>
<li><strong>Workers:</strong> 3</li>
<li><strong>Cores:</strong> 6</li>
<li><strong>Memory:</strong> 12.00 GB</li>
</ul></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dask <span class="im">import</span> dataframe <span class="im">as</span> dd </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ddf <span class="op">=</span> dd.from_pandas(df, npartitions<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ddf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dask DataFrame Structure:
                year  region province     gdp    fdi     it specific
npartitions=5                                                       
0              int64  object   object  object  int64  int64  float64
72               ...     ...      ...     ...    ...    ...      ...
...              ...     ...      ...     ...    ...    ...      ...
288              ...     ...      ...     ...    ...    ...      ...
359              ...     ...      ...     ...    ...    ...      ...
Dask Name: from_pandas, 5 tasks</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ddf.describe().visualize(filename<span class="op">=</span><span class="st">'describe.png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<p><img src="2020-10-12-dask-xgboost-fiscal-data._files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ddf.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">province</th>
<th data-quarto-table-cell-role="th">gdp</th>
<th data-quarto-table-cell-role="th">fdi</th>
<th data-quarto-table-cell-role="th">it</th>
<th data-quarto-table-cell-role="th">specific</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1996</td>
<td>East China</td>
<td>Anhui</td>
<td>2093.3</td>
<td>50661</td>
<td>631930</td>
<td>147002.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1997</td>
<td>East China</td>
<td>Anhui</td>
<td>2347.32</td>
<td>43443</td>
<td>657860</td>
<td>151981.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1998</td>
<td>East China</td>
<td>Anhui</td>
<td>2542.96</td>
<td>27673</td>
<td>889463</td>
<td>174930.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1999</td>
<td>East China</td>
<td>Anhui</td>
<td>2712.34</td>
<td>26131</td>
<td>1227364</td>
<td>285324.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000</td>
<td>East China</td>
<td>Anhui</td>
<td>2902.09</td>
<td>31847</td>
<td>1499110</td>
<td>195580.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>max_gdp_per_region <span class="op">=</span> ddf.groupby(<span class="st">'region'</span>)[<span class="st">'gdp'</span>].<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>max_gdp_per_region.visualize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<p><img src="2020-10-12-dask-xgboost-fiscal-data._files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>max_gdp_per_region.compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>region
East China             9705.02
North China            9846.81
Northwest China         956.32
South Central China     9439.6
Southwest China          937.5
Northeast China        9304.52
Name: gdp, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ddf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div><strong>Dask DataFrame Structure:</strong></div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">province</th>
<th data-quarto-table-cell-role="th">gdp</th>
<th data-quarto-table-cell-role="th">fdi</th>
<th data-quarto-table-cell-role="th">it</th>
<th data-quarto-table-cell-role="th">specific</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">npartitions=5</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>int64</td>
<td>object</td>
<td>object</td>
<td>object</td>
<td>int64</td>
<td>int64</td>
<td>float64</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">72</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">288</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">359</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody>
</table>

</div>
<div>Dask Name: from_pandas, 5 tasks</div>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ddf.npartitions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>5</code></pre>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ddf.npartitions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>5</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(ddf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>360</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dask.distributed <span class="im">import</span> Client</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> Client(processes<span class="op">=</span><span class="va">False</span>, threads_per_worker<span class="op">=</span><span class="dv">2</span>, n_workers<span class="op">=</span><span class="dv">3</span>, memory_limit<span class="op">=</span><span class="st">"4GB"</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>client</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/gao/anaconda3/lib/python3.7/site-packages/distributed/node.py:155: UserWarning: Port 8787 is already in use.
Perhaps you already have a cluster running?
Hosting the HTTP server on port 39701 instead
  http_address["port"], self.http_server.port</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<tbody>
<tr class="odd">
<td style="vertical-align: top; border: 0px solid white"><h3 id="client" style="text-align: left;" class="anchored">Client</h3>
<ul>
<li><strong>Scheduler:</strong> inproc://192.168.1.71/5995/20</li>
<li><strong>Dashboard:</strong> <a href="http://192.168.1.71:39701/status" target="_blank">http://192.168.1.71:39701/status</a></li>
</ul></td>
<td style="vertical-align: top; border: 0px solid white"><h3 id="cluster" style="text-align: left;" class="anchored">Cluster</h3>
<ul>
<li><strong>Workers:</strong> 3</li>
<li><strong>Cores:</strong> 6</li>
<li><strong>Memory:</strong> 12.00 GB</li>
</ul></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>client.<span class="bu">id</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>'Client-9f9a71c2-0c90-11eb-976b-cff3b7a8059e'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ddf.describe().compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">fdi</th>
<th data-quarto-table-cell-role="th">it</th>
<th data-quarto-table-cell-role="th">specific</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>360.000000</td>
<td>3.600000e+02</td>
<td>3.600000e+02</td>
<td>3.560000e+02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>2001.500000</td>
<td>1.961394e+05</td>
<td>2.165819e+06</td>
<td>5.834707e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>3.456857</td>
<td>3.030440e+05</td>
<td>1.769294e+06</td>
<td>6.540553e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>1996.000000</td>
<td>2.000000e+00</td>
<td>1.478970e+05</td>
<td>8.964000e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>1998.750000</td>
<td>3.309900e+04</td>
<td>1.077466e+06</td>
<td>2.237530e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>2001.500000</td>
<td>1.411025e+05</td>
<td>2.020634e+06</td>
<td>4.243700e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>2004.250000</td>
<td>4.065125e+05</td>
<td>3.375492e+06</td>
<td>1.011846e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>2007.000000</td>
<td>1.743140e+06</td>
<td>1.053331e+07</td>
<td>3.937966e+06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ddf.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>Index(['year', 'region', 'province', 'gdp', 'fdi', 'it', 'specific'], dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ddf[<span class="st">"year"</span>] <span class="op">=</span> ddf[<span class="st">"year"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ddf[<span class="st">"fdi"</span>] <span class="op">=</span> ddf[<span class="st">"fdi"</span>].astype(<span class="bu">float</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ddf["province"] = ddf["province"].astype(float)</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ddf["region"] = ddf["region"].astype(float)</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>ddf[<span class="st">"gdp"</span>] <span class="op">=</span> ddf[<span class="st">"gdp"</span>].astype(<span class="bu">float</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>ddf[<span class="st">"it"</span>] <span class="op">=</span> ddf[<span class="st">"it"</span>].astype(<span class="bu">float</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>ddf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div><strong>Dask DataFrame Structure:</strong></div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">province</th>
<th data-quarto-table-cell-role="th">gdp</th>
<th data-quarto-table-cell-role="th">fdi</th>
<th data-quarto-table-cell-role="th">it</th>
<th data-quarto-table-cell-role="th">specific</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">npartitions=5</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>int64</td>
<td>object</td>
<td>object</td>
<td>float64</td>
<td>float64</td>
<td>float64</td>
<td>float64</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">72</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">288</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">359</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody>
</table>

</div>
<div>Dask Name: assign, 65 tasks</div>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ddf.nlargest(<span class="dv">20</span>, <span class="st">'gdp'</span>).compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">province</th>
<th data-quarto-table-cell-role="th">gdp</th>
<th data-quarto-table-cell-role="th">fdi</th>
<th data-quarto-table-cell-role="th">it</th>
<th data-quarto-table-cell-role="th">specific</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">71</td>
<td>2007</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>31777.01</td>
<td>1712603.0</td>
<td>4947824.0</td>
<td>859482.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">70</td>
<td>2006</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>26587.76</td>
<td>1451065.0</td>
<td>4559252.0</td>
<td>1897575.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">263</td>
<td>2007</td>
<td>East China</td>
<td>Shandong</td>
<td>25776.91</td>
<td>1101159.0</td>
<td>6357869.0</td>
<td>2121243.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">69</td>
<td>2005</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>22557.37</td>
<td>1236400.0</td>
<td>4327217.0</td>
<td>1491588.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">262</td>
<td>2006</td>
<td>East China</td>
<td>Shandong</td>
<td>21900.19</td>
<td>1000069.0</td>
<td>5304833.0</td>
<td>1204547.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">179</td>
<td>2007</td>
<td>East China</td>
<td>Jiangsu</td>
<td>21742.05</td>
<td>1743140.0</td>
<td>3557071.0</td>
<td>1188989.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">68</td>
<td>2004</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>18864.62</td>
<td>1001158.0</td>
<td>5193902.0</td>
<td>1491588.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">359</td>
<td>2007</td>
<td>East China</td>
<td>Zhejiang</td>
<td>18753.73</td>
<td>1036576.0</td>
<td>2939778.0</td>
<td>844647.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">178</td>
<td>2006</td>
<td>East China</td>
<td>Jiangsu</td>
<td>18598.69</td>
<td>1318339.0</td>
<td>2926542.0</td>
<td>1388043.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">261</td>
<td>2005</td>
<td>East China</td>
<td>Shandong</td>
<td>18366.87</td>
<td>897000.0</td>
<td>4142859.0</td>
<td>1011203.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">67</td>
<td>2003</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>15844.64</td>
<td>782294.0</td>
<td>4073606.0</td>
<td>1550764.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">358</td>
<td>2006</td>
<td>East China</td>
<td>Zhejiang</td>
<td>15718.47</td>
<td>888935.0</td>
<td>2553268.0</td>
<td>1017303.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">260</td>
<td>2004</td>
<td>East China</td>
<td>Shandong</td>
<td>15021.84</td>
<td>870064.0</td>
<td>3732990.0</td>
<td>1011203.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">143</td>
<td>2007</td>
<td>South Central China</td>
<td>Henan</td>
<td>15012.46</td>
<td>306162.0</td>
<td>10533312.0</td>
<td>3860764.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">177</td>
<td>2005</td>
<td>East China</td>
<td>Jiangsu</td>
<td>15003.60</td>
<td>1213800.0</td>
<td>3479548.0</td>
<td>1483371.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">119</td>
<td>2007</td>
<td>North China</td>
<td>Hebei</td>
<td>13607.32</td>
<td>241621.0</td>
<td>7537692.0</td>
<td>2981235.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">66</td>
<td>2002</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>13502.42</td>
<td>1133400.0</td>
<td>3545004.0</td>
<td>1235386.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">357</td>
<td>2005</td>
<td>East China</td>
<td>Zhejiang</td>
<td>13417.68</td>
<td>772000.0</td>
<td>2370200.0</td>
<td>656175.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">275</td>
<td>2007</td>
<td>East China</td>
<td>Shanghai</td>
<td>12494.01</td>
<td>792000.0</td>
<td>2386339.0</td>
<td>272744.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">176</td>
<td>2004</td>
<td>East China</td>
<td>Jiangsu</td>
<td>12442.87</td>
<td>1056365.0</td>
<td>2410257.0</td>
<td>1483371.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>without_ec <span class="op">=</span> ddf[ddf.region <span class="op">!=</span><span class="st">'East China'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>without_ec.nlargest(<span class="dv">20</span>, <span class="st">'gdp'</span>).compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">province</th>
<th data-quarto-table-cell-role="th">gdp</th>
<th data-quarto-table-cell-role="th">fdi</th>
<th data-quarto-table-cell-role="th">it</th>
<th data-quarto-table-cell-role="th">specific</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">71</td>
<td>2007</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>31777.01</td>
<td>1712603.0</td>
<td>4947824.0</td>
<td>859482.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">70</td>
<td>2006</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>26587.76</td>
<td>1451065.0</td>
<td>4559252.0</td>
<td>1897575.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">69</td>
<td>2005</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>22557.37</td>
<td>1236400.0</td>
<td>4327217.0</td>
<td>1491588.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">68</td>
<td>2004</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>18864.62</td>
<td>1001158.0</td>
<td>5193902.0</td>
<td>1491588.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">67</td>
<td>2003</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>15844.64</td>
<td>782294.0</td>
<td>4073606.0</td>
<td>1550764.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">143</td>
<td>2007</td>
<td>South Central China</td>
<td>Henan</td>
<td>15012.46</td>
<td>306162.0</td>
<td>10533312.0</td>
<td>3860764.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">119</td>
<td>2007</td>
<td>North China</td>
<td>Hebei</td>
<td>13607.32</td>
<td>241621.0</td>
<td>7537692.0</td>
<td>2981235.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">66</td>
<td>2002</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>13502.42</td>
<td>1133400.0</td>
<td>3545004.0</td>
<td>1235386.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">142</td>
<td>2006</td>
<td>South Central China</td>
<td>Henan</td>
<td>12362.79</td>
<td>184526.0</td>
<td>7601825.0</td>
<td>2018158.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">65</td>
<td>2001</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>12039.25</td>
<td>1193203.0</td>
<td>2152243.0</td>
<td>1257232.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">118</td>
<td>2006</td>
<td>North China</td>
<td>Hebei</td>
<td>11467.60</td>
<td>201434.0</td>
<td>5831974.0</td>
<td>1253141.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">64</td>
<td>2000</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>10741.25</td>
<td>1128091.0</td>
<td>1927102.0</td>
<td>714572.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">141</td>
<td>2005</td>
<td>South Central China</td>
<td>Henan</td>
<td>10587.42</td>
<td>123000.0</td>
<td>5676863.0</td>
<td>1171796.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">299</td>
<td>2007</td>
<td>Southwest China</td>
<td>Sichuan</td>
<td>10562.39</td>
<td>149322.0</td>
<td>10384846.0</td>
<td>3937966.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">117</td>
<td>2005</td>
<td>North China</td>
<td>Hebei</td>
<td>10012.11</td>
<td>191000.0</td>
<td>4503640.0</td>
<td>859056.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>2007</td>
<td>North China</td>
<td>Beijing</td>
<td>9846.81</td>
<td>506572.0</td>
<td>1962192.0</td>
<td>752279.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">167</td>
<td>2007</td>
<td>South Central China</td>
<td>Hunan</td>
<td>9439.60</td>
<td>327051.0</td>
<td>8340692.0</td>
<td>3156087.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">155</td>
<td>2007</td>
<td>South Central China</td>
<td>Hubei</td>
<td>9333.40</td>
<td>276622.0</td>
<td>7666512.0</td>
<td>2922784.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">215</td>
<td>2007</td>
<td>Northeast China</td>
<td>Liaoning</td>
<td>9304.52</td>
<td>598554.0</td>
<td>5502192.0</td>
<td>3396397.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">63</td>
<td>1999</td>
<td>South Central China</td>
<td>Guangdong</td>
<td>9250.68</td>
<td>1165750.0</td>
<td>1789235.0</td>
<td>988521.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ddf[<span class="st">'province'</span>].compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>0         Anhui
1         Anhui
2         Anhui
3         Anhui
4         Anhui
         ...   
355    Zhejiang
356    Zhejiang
357    Zhejiang
358    Zhejiang
359    Zhejiang
Name: province, Length: 360, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>ddf.where(ddf[<span class="st">'province'</span>]<span class="op">==</span><span class="st">'Zhejiang'</span>).compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">province</th>
<th data-quarto-table-cell-role="th">gdp</th>
<th data-quarto-table-cell-role="th">fdi</th>
<th data-quarto-table-cell-role="th">it</th>
<th data-quarto-table-cell-role="th">specific</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">355</td>
<td>2003.0</td>
<td>East China</td>
<td>Zhejiang</td>
<td>9705.02</td>
<td>498055.0</td>
<td>2261631.0</td>
<td>391292.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">356</td>
<td>2004.0</td>
<td>East China</td>
<td>Zhejiang</td>
<td>11648.70</td>
<td>668128.0</td>
<td>3162299.0</td>
<td>656175.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">357</td>
<td>2005.0</td>
<td>East China</td>
<td>Zhejiang</td>
<td>13417.68</td>
<td>772000.0</td>
<td>2370200.0</td>
<td>656175.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">358</td>
<td>2006.0</td>
<td>East China</td>
<td>Zhejiang</td>
<td>15718.47</td>
<td>888935.0</td>
<td>2553268.0</td>
<td>1017303.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">359</td>
<td>2007.0</td>
<td>East China</td>
<td>Zhejiang</td>
<td>18753.73</td>
<td>1036576.0</td>
<td>2939778.0</td>
<td>844647.0</td>
</tr>
</tbody>
</table>

<p>360 rows × 7 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>mask_after_2010 <span class="op">=</span> ddf.where(ddf[<span class="st">'year'</span>]<span class="op">&gt;</span><span class="dv">2000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mask_after_2010.compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">province</th>
<th data-quarto-table-cell-role="th">gdp</th>
<th data-quarto-table-cell-role="th">fdi</th>
<th data-quarto-table-cell-role="th">it</th>
<th data-quarto-table-cell-role="th">specific</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">355</td>
<td>2003.0</td>
<td>East China</td>
<td>Zhejiang</td>
<td>9705.02</td>
<td>498055.0</td>
<td>2261631.0</td>
<td>391292.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">356</td>
<td>2004.0</td>
<td>East China</td>
<td>Zhejiang</td>
<td>11648.70</td>
<td>668128.0</td>
<td>3162299.0</td>
<td>656175.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">357</td>
<td>2005.0</td>
<td>East China</td>
<td>Zhejiang</td>
<td>13417.68</td>
<td>772000.0</td>
<td>2370200.0</td>
<td>656175.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">358</td>
<td>2006.0</td>
<td>East China</td>
<td>Zhejiang</td>
<td>15718.47</td>
<td>888935.0</td>
<td>2553268.0</td>
<td>1017303.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">359</td>
<td>2007.0</td>
<td>East China</td>
<td>Zhejiang</td>
<td>18753.73</td>
<td>1036576.0</td>
<td>2939778.0</td>
<td>844647.0</td>
</tr>
</tbody>
</table>

<p>360 rows × 7 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_some_text(cname, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Region name is "</span> <span class="op">+</span> cname</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>dummy_values <span class="op">=</span> ddf[<span class="st">'region'</span>].<span class="bu">apply</span>(add_some_text, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/gao/anaconda3/lib/python3.7/site-packages/dask/dataframe/core.py:3208: UserWarning: 
You did not provide metadata, so Dask is running your function on a small dataset to guess output types. It is possible that Dask will guess incorrectly.
To provide an explicit output types or to silence this message, please provide the `meta=` keyword, as described in the map or apply function that you are using.
  Before: .apply(func)
  After:  .apply(func, meta=('region', 'object'))

  warnings.warn(meta_warning(meta))</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dummy_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>Dask Series Structure:
npartitions=5
0      object
72        ...
        ...  
288       ...
359       ...
Name: region, dtype: object
Dask Name: apply, 75 tasks</code></pre>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>dummy_values.visualize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<p><img src="2020-10-12-dask-xgboost-fiscal-data._files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>dummy_values.compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>0      Region name is East China
1      Region name is East China
2      Region name is East China
3      Region name is East China
4      Region name is East China
                 ...            
355    Region name is East China
356    Region name is East China
357    Region name is East China
358    Region name is East China
359    Region name is East China
Name: region, Length: 360, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>max_per_region_yr <span class="op">=</span> ddf.groupby(<span class="st">'region'</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.loc[x[<span class="st">'gdp'</span>].idxmax(), <span class="st">'year'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/gao/.local/lib/python3.7/site-packages/ipykernel_launcher.py:1: UserWarning: `meta` is not specified, inferred from partial data. Please provide `meta` if the result is unexpected.
  Before: .apply(func)
  After:  .apply(func, meta={'x': 'f8', 'y': 'f8'}) for dataframe result
  or:     .apply(func, meta=('x', 'f8'))            for series result
  """Entry point for launching an IPython kernel.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>max_per_region_yr.visualize()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<p><img src="2020-10-12-dask-xgboost-fiscal-data._files/figure-html/cell-41-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>max_per_region_yr.compute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>region
North China            2007
Northeast China        2007
Northwest China        2007
South Central China    2007
East China             2007
Southwest China        2007
dtype: int64</code></pre>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>